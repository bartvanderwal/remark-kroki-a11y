#!/bin/sh

# Check for package-lock.json - we use yarn, not npm
if [ -f "package-lock.json" ] || [ -f "test-docusaurus-site/package-lock.json" ]; then
  echo ""
  echo "‚ö†Ô∏è  WARNING: package-lock.json detected!"
  echo ""
  echo "This project uses yarn, not npm. The CI/CD pipeline will fail."
  echo "Please remove package-lock.json and use 'yarn install' instead of 'npm install'."
  echo ""
  echo "To fix:"
  echo "  rm -f package-lock.json test-docusaurus-site/package-lock.json"
  echo ""
fi

# Check that yarn.lock files exist
if [ ! -f "yarn.lock" ]; then
  echo ""
  echo "‚ö†Ô∏è  WARNING: yarn.lock is missing in root!"
  echo ""
  echo "The CI/CD pipeline will fail. Run 'yarn install' to generate it."
  echo ""
fi

if [ ! -f "test-docusaurus-site/yarn.lock" ]; then
  echo ""
  echo "‚ö†Ô∏è  WARNING: yarn.lock is missing in test-docusaurus-site!"
  echo ""
  echo "The CI/CD pipeline will fail. Run 'cd test-docusaurus-site && yarn install' to generate it."
  echo ""
fi

# Run BDD tests - this IS blocking
echo "üß™ Running BDD tests..."
if ! yarn test; then
  echo ""
  echo "‚ùå ERROR: BDD tests failed!"
  echo ""
  echo "Please fix the failing tests before committing."
  echo ""
  exit 1
fi
echo "‚úÖ BDD tests passed"
