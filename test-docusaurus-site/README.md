# test-docusaurus-site

This Docusaurus site is the integration test and demo environment for
`remark-kroki-a11y`.

It is used to validate behavior across:

1. `kroki` diagrams rendered server-side (PlantUML, Mermaid, etc.)
2. accessibility output generated by the a11y plugins
3. tab/source-description interactions in real rendered pages
4. quiz functionality (`QuizDown` syntax/parser + `Quizzosaurus` component/runtime)

## What this site currently tests

### Diagrams and a11y

1. PlantUML and Mermaid examples in docs pages
2. generated source/details blocks
3. generated natural-language descriptions
4. image a11y attributes (`alt`, `aria-describedby`) via rehype step

### Quiz work (new)

1. `Quizzosaurus` UI component prototype (`src/components/Quiz`)
2. `QuizDown` syntax parser in remark plugin:
   - file: `src/remark/remark-quizdown.mjs`
   - fence: ```quiz or ```quizz
3. `Quizzosaurus` runtime behavior:
   - file: `src/quizdown-client.js`
   - submit/reset validation
   - single + multi + open short answer grading
   - show/hide hints on user action
   - option strike-out interaction
4. Debug mode:
   - `debug=true` shows source text and parsed `QuizDown` model

## Test strategy (test pyramid)

The test approach follows the classic test pyramid:

1. Unit tests (fast, many):
   parser logic, plugin transforms, utility functions
2. Integration tests (medium):
   Storybook interaction tests and a11y checks, plugin combinations in docs build
3. End-to-end tests (few, high value):
   full rendered docs behavior in browser, including manual verification paths

This test site mainly supports integration and end-to-end validation.

## Relation to BDD, Storybook and manual checks

There is intentional overlap with tests in the repository root:

1. BDD tests validate core behavior in isolated scenarios.
2. Storybook validates component interactions and a11y-focused UI behavior.
3. This Docusaurus site validates integrated behavior in realistic docs pages.

Practical interpretation:

1. BDD/unit: correctness of transformation logic
2. Storybook: interaction contracts and accessibility checks
3. Docs site + manual pass: production-like rendering and usability

For release confidence, keep a small set of risk-based manual tests as final gate.
This aligns with Continuous Delivery maturity guidance (InfoQ CDMM), where
risk-based manual verification is still valid in the "Test & Verification" area.

## Commands

From `submodules/remark-kroki-a11y/test-docusaurus-site`:

```bash
yarn start
yarn build
yarn serve
```

### Local Kroki server (Docker)

This test site uses `remark-kroki-plugin`, which fetches diagram images from Kroki.
For reliable local builds, run Kroki locally:

```bash
cd ..
docker compose -f docker-compose.kroki.yml up -d
curl http://localhost:8000/health
```

The test-site config can use:

```js
krokiBase: 'http://localhost:8000'
```

Or set:

```bash
export KROKI_BASE_URL=http://localhost:8000
```

Stop the container:

```bash
docker compose -f docker-compose.kroki.yml down
```

From `submodules/remark-kroki-a11y` (recommended full checks):

```bash
yarn test
yarn build:docs
yarn build:storybook
```

Optional local Storybook run (for interaction + a11y review):

```bash
yarn storybook
```

## Notes on module format

The quizdown remark parser in this test site is ESM:

- `src/remark/remark-quizdown.mjs`

The Docusaurus config loads it via dynamic `import(...)` to avoid CJS/ESM warnings.

## Roadmap: split quiz into dedicated packages

Current quiz work is intentionally developed in this test site first.
Next step is extraction into separate npm packages:

1. `quizdown`:
   parser + model + format rules (framework-agnostic)
2. `quizzosaurus`:
   Docusaurus adapter/runtime/UI integration

Until extraction is complete, this site remains the fastest integration sandbox.
